(()=>{"use strict";CanvasRenderingContext2D.prototype.drawRoundedImage=function(t,e,s,i,a,n,l,m,o,r){var h=l||s,c=m||i,d=o||a||t.naturalWidth,g=r||n||t.naturalHeight,u={topLeft:0,topRight:0,bottomLeft:0,bottomRight:0};switch(Array.isArray(e)||(e=[e]),u.topLeft=e[0],u.topRight=e[1]||(void 0===e[1])*e[0],u.bottomRight=e[2]||(void 0===e[2])*e[0],u.bottomLeft=e[3]||(void 0===e[3])*(e[1]||(void 0===e[1])*e[0]),this.beginPath(),this.arc(h+u.topLeft,c+u.topLeft,u.topLeft,Math.PI,Math.PI+Math.PI/2),this.lineTo(h+d-u.topRight,c),this.arc(h+d-u.topRight,c+u.topRight,u.topRight,Math.PI+Math.PI/2,2*Math.PI),this.lineTo(h+d,c+g-u.bottomRight),this.arc(h+d-u.bottomRight,c+g-u.bottomRight,u.bottomRight,2*Math.PI,Math.PI/2),this.lineTo(h+u.bottomLeft,c+g),this.arc(h+u.bottomLeft,c+g-u.bottomLeft,u.bottomLeft,Math.PI/2,Math.PI),this.closePath(),this.save(),this.clip(),!0){case arguments.length>6:this.drawImage(t,s,i,a,n,l,m,o,r);break;case arguments.length>4:this.drawImage(t,s,i,a,n);break;default:this.drawImage(t,s,i)}this.restore()};class t extends class{#stackable;#usable;#eqiupable;#bImage;constructor(t){this.name=t}setBImage(t){this.#bImage=t}getBImage(){return this.#bImage}}{#eqType;str=0;int=0;agi=0;luck=0;#itemStat=0;#rarity;constructor(t,e){super(t),this.#eqType=e}setChars(t,e,s,i){this.str=t,this.int=e,this.agi=s,this.luck=i}setRarity(t){this.#rarity=t}getRarity(){return this.#rarity}getEqType(){return this.#eqType}setItemStat(t){this.#itemStat=t}getItemStat(){return this.#itemStat}}class e{assignedItem;dWidth=65;dHeight=65;bImage="res/slot.svg";posX;posY;draw(t,e,s,i,a,n){a=void 0!==a?a:65,n=void 0!==n?n:65;let l=!1,m=i.getContext("2d"),o=new Image;null!=this.assignedItem?(o.src=this.assignedItem.getBImage(),l=!0):o.src=this.bImage,this.posX=t,this.posY=e,o.onload=function(){m.clearRect(t,e,a,n),l?m.drawRoundedImage(o,10,t,e,a,n):m.drawRoundedImage(o,7,t,e,a,n),s&&(o.src="res/active-border.svg",o.onload=function(){m.drawImage(o,t,e)})}}setPosition(t,e){this.posX=t,this.posY=e}}class s extends e{isActiveSlot=!1;setActive(){this.activeSlot=!0}isActive(){return this.isActiveSlot}}class i extends e{isActiveSlot=!1;setActive(){this.activeSlot=!0}isActive(){return this.isActiveSlot}}let a=new class{#name;#class;#strength;#agility;#intelligence;#luck;#inBattle=!1;health;mana;stamina;#attack=5;#sumAttack;#armor=0;#sumArmor;#maxHealth;#maxMana;#maxStamina;#equipStats;#stats;constructor(t,e,s,i){this.#strength=t||0,this.#agility=s||0,this.#intelligence=e||0,this.#luck=i||0,this.#maxHealth=1.25*this.#strength+100,this.health=1.25*this.#strength+100,this.#maxMana=1.25*this.#intelligence+100,this.mana=1.25*this.#intelligence+100,this.#maxStamina=.25*this.#agility+100,this.stamina=1.25*this.#agility+100,this.#stats=[this.strength,this.intelligence,this.agility,this.luck,this.#attack,this.#armor]}inBattle(){return this.#inBattle}setName(t){this.#name=t}setClass(t){this.#class=t}updateStats(t){this.#equipStats=t.getEquipmentStats(),this.#stats[0]=this.#strength+this.#equipStats[0],this.#stats[1]=this.#agility+this.#equipStats[1],this.#stats[2]=this.#intelligence+this.#equipStats[2],this.#stats[3]=this.#luck+this.#equipStats[3],this.#stats[4]=this.#attack+this.#equipStats[4],this.#stats[5]=this.#armor+this.#equipStats[5]}whenUnEquip(t){this.#equipStats[0]-=t.str,this.#equipStats[1]-=t.int,this.#equipStats[2]-=t.agi,this.#equipStats[3]-=t.luck,"weapon"==t.getEqType()?this.#equipStats[4]-=t.getItemStat():this.#equipStats[5]-=t.getItemStat()}getSummaryStats(){return this.#stats}updateState(){if(1.25*this.#stats[0]+100<=0||1.25*this.#stats[2]+100<=0)return;this.#maxHealth=.75*this.#stats[0]+100,(this.#maxMana=.75*this.#stats[1]+100<0)?this.#maxMana=0:this.#maxMana=.75*this.#stats[1]+100,this.#maxStamina=.75*this.#stats[2]+100,this.#sumAttack=this.#stats[4],this.#sumArmor=this.#stats[5];let t=document.getElementsByClassName("hp")[0].parentElement.children[1],e=document.getElementsByClassName("mana")[0].parentElement.children[1],s=document.getElementsByClassName("stamina")[0].parentElement.children[1],i=document.getElementsByClassName("playerStr")[0].children[1],a=document.getElementsByClassName("playerInt")[0].children[1],n=document.getElementsByClassName("playerAgi")[0].children[1],l=document.getElementsByClassName("playerLuck")[0].children[1],m=document.getElementsByClassName("playerAttack")[0].children[1],o=document.getElementsByClassName("playerDeffense")[0].children[1];this.#inBattle||(this.health=this.#maxHealth,this.mana=this.#maxMana,this.stamina=this.#maxStamina,i.innerHTML=this.#stats[0],a.innerHTML=this.#stats[1],n.innerHTML=this.#stats[2],l.innerHTML=this.#stats[3],m.innerHTML=this.#sumAttack,o.innerHTML=this.#sumArmor=this.#stats[5],t.innerHTML=this.health+" / "+this.#maxHealth,e.innerHTML=this.mana+" / "+this.#maxMana,s.innerHTML=this.stamina+" / "+this.#maxStamina)}getDmg(t){let e=document.getElementsByClassName("hp")[0].children[0];this.health-t<=0?(console.log("dead"),e.style.width="0%"):(console.log(this.health+" "+t),this.health-=t+this.#armor,e.style.width=100*this.health/this.#maxHealth+"%")}attack(){}}(sessionStorage.getItem("str"),sessionStorage.getItem("int"),sessionStorage.getItem("agi"),sessionStorage.getItem("luck"));a.setName(sessionStorage.getItem("name"));const n=a;let l,m=new class{#equipCanvas=document.getElementById("equipment");#itemHead=new i;#itemShoulder=new i;#itemAmulet=new i;#itemWeapon=new i;#itemLeftHand=new i;#itemChest=new i;#itemLegs=new i;#itemBoots=new i;slots=[this.#itemHead,this.#itemShoulder,this.#itemAmulet,this.#itemWeapon,this.#itemLeftHand,this.#itemChest,this.#itemLegs,this.#itemBoots];#activeSlot;equipItem(t,e,s){if(n.inBattle())return;if(null==t)return;n.updateStats(s);let i,a=n.getSummaryStats();if(!(a[0]+1.25*t.str+100<=0||a[2]+1.25*t.agi+100<=0)){switch(t.getEqType()){case"head":null!=this.#itemHead?(i=e.getActiveSlot().assignedItem,e.getActiveSlot().assignedItem=this.#itemHead.assignedItem,this.#itemHead.assignedItem=i):(this.#itemHead.assignedItem=t,e.getActiveSlot().assignedItem=null);break;case"shoulder":null!=this.#itemShoulder?(i=e.getActiveSlot().assignedItem,e.getActiveSlot().assignedItem=this.#itemShoulder,this.#itemShoulder.assignedItem=i):(this.#itemShoulder.assignedItem=t,e.getActiveSlot().assignedItem=null);break;case"amulet":case"weapon":case"left-hand":case"chest":case"legs":null!=this.#itemLegs?(i=e.getActiveSlot().assignedItem,e.getActiveSlot().assignedItem=this.#itemLegs.assignedItem,this.#itemLegs.assignedItem=i):(this.#itemLegs.assignedItem=t,e.getActiveSlot().assignedItem=null);break;case"boots":null!=this.#itemBoots?(i=e.getActiveSlot().assignedItem,e.getActiveSlot().assignedItem=this.#itemBoots,this.#itemBoots.assignedItem=i):(this.#itemBoots.assignedItem=t,e.getActiveSlot().assignedItem=null)}n.updateStats(s),n.updateState(),console.log(n),this.equipDraw()}}unEquipItem(t,e,s){n.inBattle()||(e.addItem(t),n.whenUnEquip(t),s.#activeSlot.assignedItem=null)}getEquipmentStats(){let t,e=0,s=0,i=0,a=0,n=0,l=0;return this.slots.forEach((t=>{null!=t.assignedItem&&(null!=t.assignedItem.str&&(e+=t.assignedItem.str),null!=t.assignedItem.int&&(s+=t.assignedItem.int),null!=t.assignedItem.agi&&(i+=t.assignedItem.agi),null!=t.assignedItem.luck&&(a+=t.assignedItem.luck),"weapon"==t.assignedItem.getEqType()?n+=t.assignedItem.getItemStat():l+=t.assignedItem.getItemStat())})),t=[e,s,i,a,n,l],t}setActiveSlot(t,e){this.slots.forEach((s=>{t>=s.posX&&t<=s.posX+s.dWidth&&e>=s.posY&&e<=s.posY+s.dHeight&&(this.#activeSlot?(this.#activeSlot.isActiveSlot=!1,this.#activeSlot=s):this.#activeSlot=s,this.#activeSlot.isActiveSlot=!s.isActiveSlot)}))}firstInit(){let t=this.#equipCanvas.getContext("2d"),e=new Image;e.src="res/equip-man.svg",e.onload=function(){t.drawImage(e,10,10)}}equipDraw(){this.#itemHead.draw(161,28,null,this.#equipCanvas),this.#itemShoulder.draw(80,116,null,this.#equipCanvas),this.#itemChest.draw(161,204,null,this.#equipCanvas),this.#itemLegs.draw(161,298,null,this.#equipCanvas),this.#itemWeapon.draw(14,288,null,this.#equipCanvas),this.#itemLeftHand.draw(307,288,null,this.#equipCanvas),this.#itemBoots.draw(241,574,null,this.#equipCanvas),this.#itemAmulet.draw(175,116,null,this.#equipCanvas,38,38)}getActiveSlot(){return this.#activeSlot}setPopupInfo(){let t=document.getElementsByClassName("inventory-popup")[0];if(null==this.#activeSlot||null==this.#activeSlot.assignedItem)return void(t.style.visibility="hidden");let e=this.#activeSlot.assignedItem,s=document.getElementsByClassName("item-name")[0].children[0],i=document.getElementsByClassName("item-type")[0].children[0],a=document.getElementsByClassName("item-info")[0].children[0],n=document.getElementsByClassName("attack-defence")[0].children[0],l=document.getElementsByClassName("attack-defence")[0].children[1],m=document.getElementsByClassName("attack-defence")[0].children[2],o=document.getElementsByClassName("str")[0],r=document.getElementsByClassName("int")[0],h=document.getElementsByClassName("agi")[0],c=document.getElementsByClassName("luck")[0],d=document.getElementsByClassName("equipB")[0].children[0];switch(e.getRarity()){case"Common":t.style.backgroundImage="url(res/item-rarity-common.svg)";break;case"Uncommon":t.style.backgroundImage="url(res/item-rarity-uncommon.svg)";break;case"Rare":t.style.backgroundImage="url(res/item-rarity-rare.svg)";break;case"Epic":t.style.backgroundImage="url(res/item-rarity-epic.svg)";break;case"Legendary":t.style.backgroundImage="url(res/item-rarity-legendary.svg)"}s.innerHTML=e.name,i.innerHTML=e.getEqType(),a.style.backgroundImage="url("+e.getBImage()+")","weapon"==e.getEqType()?(n.src="res/atk-icon.svg",m.innerHTML="Атака"):(n.src="res/def-icon.svg",m.innerHTML="Защита"),l.innerHTML=e.getItemStat(),e.str>0?(o.style.color="#90CC54",o.innerHTML="+"+e.str):e.str<=0&&(o.style.color="#E37171",o.innerHTML=e.str),e.int>0?(r.style.color="#90CC54",r.innerHTML="+"+e.int):e.int<=0&&(r.style.color="#E37171",r.innerHTML=e.int),e.agi>0?(h.style.color="#90CC54",h.innerHTML="+"+e.agi):e.agi<=0&&(h.style.color="#E37171",h.innerHTML=e.agi),e.luck>0?(c.style.color="#90CC54",c.innerHTML="+"+e.luck):e.luck<=0&&(c.style.color="#E37171",c.innerHTML=e.luck),d.innerHTML="Снять"}closePopup(){document.getElementsByClassName("inventory-popup")[0].style.visibility="hidden"}},o=new class{#invCanvas=document.getElementsByClassName("inventory")[0].children[0];#itemMas=[[,,,,,,],[,,,,,,],[,,,,,,],[,,,,,,],[,,,,,,],[,,,,,,],[,,,,,,],[,,,,,,],[,,,,,,]];#invWidth=6;#invHeight=9;#activeSlot=0;firstInit(){for(let t=0;t<this.#invHeight;t++)for(let e=0;e<this.#invWidth;e++)this.#itemMas[t][e]=new s}drawInv(){for(let t=0;t<9;t++)for(let e=0;e<6;e++)this.#itemMas[t][e].draw(0+69*e,0+69*t,this.#itemMas[t][e].isActive(),this.#invCanvas)}setActiveSlot(t,e){for(let s=0;s<9;s++)for(let i=0;i<6;i++)t>=this.#itemMas[s][i].posX&&t<=this.#itemMas[s][i].posX+this.#itemMas[s][i].dWidth&&e>=this.#itemMas[s][i].posY&&e<=this.#itemMas[s][i].posY+this.#itemMas[s][i].dHeight&&(this.#activeSlot?(this.#activeSlot.isActiveSlot=!1,this.#activeSlot=this.#itemMas[s][i]):this.#activeSlot=this.#itemMas[s][i],this.#activeSlot.isActiveSlot=!this.#itemMas[s][i].isActiveSlot)}addItem(t){let e=!1;for(let s=0;s<9;s++)for(let i=0;i<6;i++)0==e&&null==this.#itemMas[s][i].assignedItem&&(this.#itemMas[s][i].assignedItem=t,e=!0)}setPopupInfo(){let t=document.getElementsByClassName("inventory-popup")[0],e=document.getElementsByClassName("equipB")[0].children[0];if(null==this.#activeSlot.assignedItem)return void(t.style.visibility="hidden");let s=this.#activeSlot.assignedItem,i=document.getElementsByClassName("item-name")[0].children[0],a=document.getElementsByClassName("item-type")[0].children[0],n=document.getElementsByClassName("item-info")[0].children[0],l=document.getElementsByClassName("attack-defence")[0].children[0],m=document.getElementsByClassName("attack-defence")[0].children[1],o=document.getElementsByClassName("attack-defence")[0].children[2],r=document.getElementsByClassName("str")[0],h=document.getElementsByClassName("int")[0],c=document.getElementsByClassName("agi")[0],d=document.getElementsByClassName("luck")[0];if(null==s)t.style.visibility="hidden";else switch(s.getRarity()){case"Common":t.style.backgroundImage="url(res/item-rarity-common.svg)";break;case"Uncommon":t.style.backgroundImage="url(res/item-rarity-uncommon.svg)";break;case"Rare":t.style.backgroundImage="url(res/item-rarity-rare.svg)";break;case"Epic":t.style.backgroundImage="url(res/item-rarity-epic.svg)";break;case"Legendary":t.style.backgroundImage="url(res/item-rarity-legendary.svg)"}i.innerHTML=s.name,a.innerHTML=s.getEqType(),n.style.backgroundImage="url("+s.getBImage()+")","weapon"==s.getEqType()?(l.src="res/atk-icon.svg",o.innerHTML="Атака"):(l.src="res/def-icon.svg",o.innerHTML="Защита"),m.innerHTML=s.getItemStat(),s.str>0?(r.style.color="#90CC54",r.innerHTML="+"+s.str):s.str<=0&&(r.style.color="#E37171",r.innerHTML=s.str),s.int>0?(h.style.color="#90CC54",h.innerHTML="+"+s.int):s.int<=0&&(h.style.color="#E37171",h.innerHTML=s.int),s.agi>0?(c.style.color="#90CC54",c.innerHTML="+"+s.agi):s.agi<=0&&(c.style.color="#E37171",c.innerHTML=s.agi),s.luck>0?(d.style.color="#90CC54",d.innerHTML="+"+s.luck):s.luck<=0&&(d.style.color="#E37171",d.innerHTML=s.luck),e.innerHTML="Надеть"}closePopup(){document.getElementsByClassName("inventory-popup")[0].style.visibility="hidden"}chooseSlot(t){}getItemMas(){return this.#itemMas}getActiveSlot(){return this.#activeSlot}},r=(new class{#eventText;#answers=[];#eventBox=document.getElementsByClassName("events")[0];#answerBox=document.getElementsByClassName("event-answers")[0];constructor(t){this.name=t}setEventText(t){this.#eventText=t}addEventAnswer(t){this.#answers.push(t)}buildEvent(){let t=document.createElement("h1"),e=document.createElement("ol");t.setAttribute("class","eventText"),t.innerHTML=this.#eventText,this.#eventBox.appendChild(t);for(let t=0;t<this.#answers.length;t++){let s=document.createElement("li");s.innerHTML=this.#answers[t],e.appendChild(s),this.#answerBox.appendChild(e)}}},0),h=document.getElementsByClassName("equipB")[0],c=document.getElementsByClassName("inventory-popup")[0],d=document.getElementsByClassName("inventory")[0].children[0],g=document.getElementById("equipment"),u=new t("Кираса","chest");u.setChars(2,0,-1,0),u.setBImage("res/icon.png"),u.setRarity("Common");let p=new t("Обоссанный щит","left-hand");p.setChars(15,0,-2,-5),p.setBImage("res/shield.png"),p.setRarity("Rare");let y=new t("Обоссанный меч","weapon");y.setChars(7,1,-2,1),y.setBImage("res/sword.png"),y.setRarity("Epic");let v=new t("Меч Анн Чоуса","weapon");v.setChars(1e3,-1e3,1e3,-1e3),v.setBImage("res/anec-sword.png"),v.setRarity("Legendary"),v.setItemStat(10);let I=new t("Кожаный наргудник","chest");I.setChars(2,1,4,0),I.setBImage("res/leather-chest.png"),I.setRarity("Common"),I.setItemStat(10);let S=new t("Кожаный щлемак","head");S.setBImage("res/leather-helmet.png"),S.setRarity("Uncommon"),S.setChars(2,2,2,2);let C=new t("Кожаный щлемак","head");C.setBImage("res/leather-helmet2.png"),C.setRarity("Uncommon"),C.setChars(2,2,2,2);let E=new t("Кожаный щлемак","head");E.setBImage("res/leather-helmet3.png"),E.setRarity("Uncommon"),E.setChars(2,2,2,2),document.onload=m.firstInit(),document.onload=m.equipDraw(),document.onload=o.firstInit(),o.addItem(u),o.addItem(p),o.addItem(y),o.addItem(v),o.addItem(I),o.addItem(S),o.addItem(C),o.addItem(E),document.onload=o.drawInv(),d.addEventListener("click",(function(t){let e,s=d.getBoundingClientRect(),i=t.clientX-s.left,a=t.clientY-s.top,n=t.pageX,m=t.pageY;n>=1300&&(n=1200),o.setActiveSlot(i,a),0==r?(c.style.left=n+5+"px",c.style.top=m+5+"px",c.style.visibility="visible",r=1,e=o.getActiveSlot()):(e==o.getActiveSlot()?c.style.visibility="hidden":(c.style.left=n+5+"px",c.style.top=m+5+"px",c.style.visibility="visible"),r=0),l=0,o.setPopupInfo(),o.drawInv()})),d.addEventListener("dblclick",(function(){m.equipItem(o.getActiveSlot().assignedItem,o,m),o.closePopup(),m.equipDraw(),o.drawInv()})),g.addEventListener("click",(function(t){let e,s=g.getBoundingClientRect(),i=t.clientX-s.left,a=t.clientY-s.top,n=t.pageX,o=t.pageY;m.setActiveSlot(i,a),i>=m.getActiveSlot().posX&&i<=m.getActiveSlot().posX+m.getActiveSlot().dWidth&&a>=m.getActiveSlot().posY&&a<=m.getActiveSlot().posY+m.getActiveSlot().dHeight?0==r?(c.style.left=n+5+"px",c.style.top=o+5+"px",c.style.visibility="visible",r=1,e=m.getActiveSlot()):(e==m.getActiveSlot()?c.style.visibility="hidden":(c.style.left=n+5+"px",c.style.top=o+5+"px",c.style.visibility="visible"),r=0):(r=0,c.style.visibility="hidden"),l=1,m.setPopupInfo(),m.equipDraw()})),g.addEventListener("dblclick",(function(){m.unEquipItem(m.getActiveSlot().assignedItem,o),n.updateStats(m),n.updateState(),m.closePopup(),m.equipDraw(),o.drawInv()})),c.addEventListener("click",(function(){n.updateState()})),h.addEventListener("click",(function(){0==l?(m.equipItem(o.getActiveSlot().assignedItem,o,m),o.closePopup(),m.equipDraw(),o.drawInv()):(m.unEquipItem(m.getActiveSlot().assignedItem,o,m,m),n.updateStats(m),n.updateState(),m.closePopup(),m.equipDraw(),o.drawInv())}))})();